using System.Data;

namespace ConnectKsmcDAL.Report
{
    public class R06201DAL : CommonDAL
    {
        public DataTable GetReport(string patNo, string visitDate)
        {
            return ReportQuery($@"SELECT DISTINCT T_FIRST_LANG2_NAME ||' ' ||T_FATHER_LANG2_NAME ||' ' || T_GFATHER_LANG2_NAME ||' ' ||T_FAMILY_LANG2_NAME T_NAME_ENG, T_FIRST_LANG1_NAME ||' ' ||T_FATHER_LANG1_NAME ||' ' || T_GFATHER_LANG1_NAME ||' ' ||T_FAMILY_LANG1_NAME T_NAME_AR, T_GENDER , T06.T_LANG2_NAME GENDER_DES_ENG, T06.T_LANG1_NAME GENDER_DES_AR, t01. T_NTNLTY_CODE, T03.T_LANG2_NAME NTNLTY_ENG, T03.T_LANG1_NAME NTNLTY_AR, TO_CHAR(T_BIRTH_DATE,'dd/MM/yyyy') T_BIRTH_DATE, (SELECT TRUNC(MONTHS_BETWEEN(SYSDATE,T_BIRTH_DATE)/12) FROM DUAL ) AGE_Y, (SELECT TRUNC(MOD(MONTHS_BETWEEN(SYSDATE, T_BIRTH_DATE), 12)) FROM DUAL ) AGE_M, T_X_RMC_CHRTNO, T_JOB_CODE , T19.T_LANG2_NAME OCCUPATION_ENG, T19.T_LANG1_NAME OCCUPATION_AR, t01. T_pat_no, T_1022.T_ADMIT_DATE, (CASE WHEN HIJRAAH(T_1022.T_ADMIT_DATE)='///' THEN null ELSE HIJRAAH(T_1022.T_ADMIT_DATE)END) T_ADMIT_DATE_HIJ, T_1022.T_CLN_DISCH_DATE, (CASE WHEN HIJRAAH(T_1022.T_CLN_DISCH_DATE)='///' THEN null ELSE HIJRAAH(T_1022.T_CLN_DISCH_DATE)END) T_CLN_DISCH_DATE_HIJ, T_1022.T_EPISODE_NO, v21. PAT_TYPE, t201.T_SICK_LEAVE_SEQ, TO_CHAR(t201.T_ADM_DATE,'dd/MM/yyyy') T_ADM_DATE, (CASE WHEN HIJRAAH(t201.T_ADM_DATE)='///' THEN null ELSE HIJRAAH(t201.T_ADM_DATE)END) T_ADM_DATE_HIJ, TO_CHAR(t201.T_DISCHARGE_DATE,'dd/MM/yyyy') T_DISCHARGE_DATE, (CASE WHEN HIJRAAH(t201.T_DISCHARGE_DATE)='///' THEN null ELSE HIJRAAH(t201.T_DISCHARGE_DATE)END) T_DISCHARGE_DATE_HIJ, t201.T_CONS_DOC_CODE, TO_CHAR(t201.T_VISIT_DATE,'dd/MM/yyyy') T_VISIT_DATE, (CASE WHEN HIJRAAH(t201.T_VISIT_DATE)='///' THEN null ELSE HIJRAAH(t201.T_VISIT_DATE)END) T_VISIT_DATE_HIJ, t201.T_SICK_FLAG, t201.T_LEAVE_DAYS, t201.T_CONS_DOC, t201.T_LEAVE_DAYS, TO_CHAR(t201.T_START_DATE,'dd/MM/yyyy') T_START_DATE, (CASE WHEN HIJRAAH(t201.T_START_DATE)='///' THEN null ELSE HIJRAAH(t201.T_START_DATE)END) T_START_DATE_HIJ, TO_CHAR(t201.T_END_DATE,'dd/MM/yyyy') T_END_DATE, (CASE WHEN HIJRAAH(t201.T_END_DATE)='///' THEN null ELSE HIJRAAH(t201.T_END_DATE)END) T_END_DATE_HIJ, (CASE WHEN t201.T_FU_FLAG is null THEN '0' ELSE '1' END) T_FU_FLAG, (CASE WHEN t201.T_MED_COM_FLAG is null THEN '0' ELSE '1' END) T_MED_COM_FLAG, t201.T_MED_COM_RSN, (CASE WHEN t201.T_APPROVAL_FLAG is null THEN '0' ELSE '1' END) T_APPROVAL_FLAG, (CASE WHEN t201.T_CNT_TREAT_FLAG is null THEN '0' ELSE '1' END) T_CNT_TREAT_FLAG, (CASE WHEN t201.T_PRMNT_PAR_FLAG is null THEN '0' ELSE '1' END) T_PRMNT_PAR_FLAG, (CASE WHEN t201.T_OTHER_FLAG is null THEN '0' ELSE '1' END) T_OTHER_FLAG, t201.T_OTHER_RSN, t201.T_TREAT_DOC_CODE, t201.T_TREAT_DOC, t201.T_BADGE_NO, t201.T_DOC_CODE, t201.T_DOC_CODE, t201.T_OCCUPATION, t201.T_PLACE_WORK, t201.T_DIRECTOR, t201.T_SIGN_DATE, t201.T_LETTER_HEAD, t201.T_LETTER_REF_NO, (CASE WHEN t201.T_PRINT_FLAG is null THEN '0' ELSE '1' END) T_PRINT_FLAG,  TO_CHAR(t201.T_LETTER_DATE,'dd/MM/yyyy') T_LETTER_DATE, t201.T_MR_NAME, t201.T_OLD_REPORT_NO, t201.T_OLD_REPORT_DATE, t201.T_UPD_DATE, t201.T_UPD_USER, t201.T_SIGN_FLAG, t201.T_ENTRY_USER, t201.T_ENTRY_DATE, t201.T_LEAVE_DAYS_ARB, t201.T_TEMP_NO, t201.T_PAT_TYPE, t201.T_EPISODE_NO, t201.T_EXP_NO FROM T03001 t01 LEFT JOIN T02003 t03 ON t01. T_NTNLTY_CODE= t03.t_ntnlty_code LEFT JOIN T02006 t06 ON t01.T_GENDER = t06.t_sex_code LEFT JOIN V35021 v21 ON t01.T_pat_no = v21.T_PAT_NO LEFT JOIN T02019 t19 ON t01.T_JOB_CODE = t19.T_JOB_TITLE_CODE LEFT JOIN (SELECT A.T_ADMIT_DATE, B.T_CLN_DISCH_DATE, A.T_EPISODE_NO, A.T_PAT_NO FROM t05010 A, T05022 B WHERE A.T_PAT_NO =B.T_PAT_NO AND A.T_EPISODE_NO =B.T_EPISODE_NO AND B.T_CLN_DISCH_DATE >= TRUNC(SYSDATE) -275 ) T_1022 ON t01.T_pat_no =T_1022.T_PAT_NO JOIN t06201 t201 ON t01.T_pat_no = t201.T_PAT_NO WHERE t01.T_pat_no = '{patNo}' AND t201.T_VISIT_DATE =nvl(TO_DATE('{visitDate}','dd/mm/yyyy'), t201.T_VISIT_DATE)");
        }
        public DataTable GetHeaderData(string siteCode)
        {
            return ReportQuery($@"select T_SITE_CODE , T_COUNTRY_LANG1_NAME , T_COUNTRY_LANG2_NAME , T_MIN_LANG1_NAME , T_MIN_LANG2_NAME , T_SITE_LANG1_NAME , T_SITE_LANG2_NAME , T_LOGO_ID , T_LOGO_NAME , T_LOGO , t_lcence_no from t01028 where t_site_code =00001");
        }
        public DataTable GetDoctorInfo(string empCode)
        {
            return ReportQuery($@"SELECT RTRIM(A.T_NAME_GIVEN,' ')||' '||RTRIM(A.T_NAME_FATHER,' ') ||' '||RTRIM(A.T_NAME_GFATHER,' ')||' '||RTRIM(A.T_NAME_FAMILY,' ') DOC_DES_ENG, RTRIM(A.T_NAME_GIVEN_ARB,' ')||' '||RTRIM(A.T_NAME_FATHER_ARB,' ') ||' '||RTRIM(A.T_NAME_GFATHER_ARB,' ')||' '||RTRIM(A.T_NAME_FAMILY_ARB,' ') DOC_DES_ARB, B.T_DOC_CODE FROM T02029 A, T02039 B WHERE B.T_DOC_CODE = A.T_EMP_NO and b.t_doc_code='{empCode}' AND A.T_EMP_ACTIVE ='1'");
        }
    }
}

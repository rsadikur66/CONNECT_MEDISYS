
using System.Data;


namespace ConnectKsmcDAL.Report
{
   public class R13115DAL :CommonDAL
    {
                
        public DataTable GetHeaderData(string siteCode)
        {
            return ReportQuery($@"SELECT T_SITE_CODE , T_COUNTRY_LANG1_NAME , T_COUNTRY_LANG2_NAME , T_MIN_LANG1_NAME , T_MIN_LANG2_NAME , T_SITE_LANG1_NAME , T_SITE_LANG2_NAME , T_LOGO_ID , T_LOGO_NAME , T_LOGO , T_LCENCE_NO FROM t01028 WHERE T_SITE_CODE IN(SELECT T_SITE_CODE FROM t01001)");
        }
        public DataTable GetMasterData(string reqNo)
        {
            return ReportQuery($@"select a.T_PAT_NO, a.T_EXTERNAL_FLAG, ( CASE WHEN a.T_EXTERNAL_FLAG IS NOT NULL THEN 'YES' ELSE '' END )T_EXTERNAL_STATUS, (SELECT NVL(T_X_RMC_CHRTNO,T_X_HOSP1_PAT_NO) FROM T03001 WHERE T_PAT_NO =a.T_PAT_NO ) HOSP_NO, (SELECT T_X_HOSP7_PAT_NO FROM T03001 WHERE T_PAT_NO = a.T_PAT_NO ) RCH_NO, ( CASE WHEN (SELECT T_X_HOSP7_PAT_NO FROM T03001 WHERE T_PAT_NO = a.T_PAT_NO) IS NOT NULL THEN ' AKU# ' ELSE '' END )TXT, a.T_LOCATION_CODE, ( CASE WHEN T_PAT_TYPE ='2' THEN ( CASE WHEN t_location_code ='2000' THEN 'OPD Central' ELSE ( CASE WHEN (SELECT T_CLINIC_NAME_LANG2 FROM T07001 WHERE T_CLINIC_CODE = a.T_LOCATION_CODE) IS NOT NULL THEN (SELECT T_CLINIC_NAME_LANG2 FROM T07001 WHERE T_CLINIC_CODE = a.T_LOCATION_CODE ) ELSE (SELECT T_LANG2_NAME FROM T02042 WHERE t_loc_code = a.T_LOCATION_CODE ) END ) END ) WHEN T_PAT_TYPE ='3' THEN ( SELECT t_lang2_name FROM t04003 WHERE t_er_location = a.T_LOCATION_CODE ) WHEN (SELECT T_LANG2_NAME FROM T02042 WHERE t_loc_code = a.T_LOCATION_CODE) IS NOT NULL THEN (SELECT T_LANG2_NAME FROM T02042 WHERE t_loc_code = a.T_LOCATION_CODE ) ELSE (SELECT T_CLINIC_NAME_LANG2 FROM T07001 WHERE T_CLINIC_CODE = a.T_LOCATION_CODE ) END )location_dscrptn, a.T_PAT_TYPE , (SELECT t_lang2_name FROM t05020 WHERE t_episode_type = a.T_PAT_TYPE ) type_dscrptn, ( CASE WHEN a.T_EXTERNAL_FLAG IS NULL THEN (SELECT DECODE(T_PAYOR_Y,'1','Yes','No') FROM t03001 WHERE T_PAT_NO= a.T_PAT_NO ) ELSE'' END ) PAYOR, a.T_PRIORITY_CODE, (SELECT t_lang2_name FROM t13003 WHERE t_priority_code = a.T_PRIORITY_CODE ) priority_dscrptn, (SELECT 'Requested By : ' || t_user_name FROM t01009 WHERE t_emp_code = a.T_ENTRY_USER ) user_name, (SELECT T_X_AIDS_PATNO FROM t03001 WHERE T_X_AIDS_PATNO IS NOT NULL AND t_PAT_NO =a.T_PAT_NO )T_X_AIDS_PATNO , (SELECT T_ROOM_NO ||'--' || T_BED_NO FROM T05005 WHERE T_PAT_NO = a.T_PAT_NO ) ROOM, a.T_REQUEST_DATE , (a.T_REQUEST_DATE ||' ' || a.t_REQUEST_TIME ) DATE_TIME, ( CASE WHEN T_EXTERNAL_FLAG IS NULL THEN (SELECT T_FIRST_LANG2_NAME ||' ' ||T_FATHER_LANG2_NAME ||' ' || T_GFATHER_LANG2_NAME ||' ' ||T_FAMILY_LANG2_NAME FROM t03001 WHERE t_pat_no = a.T_PAT_NO ) ELSE (SELECT T_FIRST_LANG2_NAME ||' ' ||T_FATHER_LANG2_NAME ||' ' || T_GFATHER_LANG2_NAME ||' ' ||T_FAMILY_LANG2_NAME FROM t03003 WHERE t_tmp_pat_no = a.T_PAT_NO ) END ) pat_name_eng, ( CASE WHEN a.T_EXTERNAL_FLAG IS NULL THEN (SELECT T_FIRST_LANG1_NAME ||' ' ||T_FATHER_LANG1_NAME ||' ' || T_GFATHER_LANG1_NAME ||' ' ||T_FAMILY_LANG1_NAME FROM t03001 WHERE t_pat_no = a.T_PAT_NO ) ELSE (SELECT T_FIRST_LANG1_NAME ||' ' ||T_FATHER_LANG1_NAME ||' ' || T_GFATHER_LANG1_NAME ||' ' ||T_FAMILY_LANG1_NAME FROM t03003 WHERE t_tmp_pat_no = a.T_PAT_NO ) END ) pat_name_arb, ( CASE WHEN a.T_EXTERNAL_FLAG IS NULL THEN (SELECT T02006.T_LANG2_NAME FROM t03001 t_pat JOIN t02006 ON t_pat.t_gender = T02006.T_SEX_CODE WHERE T_PAT_NO = a.T_PAT_NO ) ELSE (SELECT T02006.T_LANG2_NAME FROM t03003 t_pat JOIN t02006 ON t_pat.t_gender = T02006.T_SEX_CODE WHERE T_TMP_PAT_NO = a.T_PAT_NO ) END ) T_GENDER , (CASE WHEN a.T_EXTERNAL_FLAG IS NULL THEN (SELECT TRUNC ( (sysdate-T_BIRTH_DATE)/365,0) || ' ' || 'Y' || ' ' ||TRUNC(MOD(MONTHS_BETWEEN(sysdate,T_BIRTH_DATE), 12), 0) || ' ' ||'M' || ' ' || TRUNC ((sysdate) - add_months( T_BIRTH_DATE,TRUNC(months_between(TRUNC(sysdate),T_BIRTH_DATE)))) ||' ' ||'D' FROM t03001 WHERE t03001.T_PAT_NO = a.T_PAT_NO ) ELSE (SELECT TRUNC ( (sysdate-T_BIRTH_DATE)/365,0) || ' ' || 'Y' ||' ' || TRUNC(MOD(MONTHS_BETWEEN(sysdate,T_BIRTH_DATE), 12), 0) || ' ' ||'M' || ' ' ||TRUNC ((sysdate) - add_months( T_BIRTH_DATE,TRUNC(months_between(TRUNC(sysdate),T_BIRTH_DATE)))) ||' ' ||'D' FROM t03003 WHERE t_TMP_PAT_NO = a.T_PAT_NO ) END ) T_AGE , (SELECT t_lang2_name FROM t13011 WHERE t_analysis_code =b.t_ANALYSIS_CODE AND t_ws_code = b.t_ws_code ) ANALYSIS_DSCRPTN, (SELECT T_NAME_GIVEN ||' ' || T_NAME_FATHER ||' ' ||T_NAME_FAMILY FROM T02029 WHERE T_EMP_NO = a.T_DOC_CODE ) doctor_name, a.T_REQUEST_NO , '!'||a.T_REQUEST_NO||'!' BC, a.T_REQUEST_TIME , a.T_DOC_CODE, a.T_COMMENT_LINE, a.T_CLINIC_DATA , A.T_ENTRY_USER , a.T_APPT_DATE, (CASE WHEN a.T_APPT_DATE IS NOT NULL THEN '.نـــــرجـــــو الاعتمــــــاد علـــــى الــــــيوم عنـــــد اختـــــلاف التاريـــــخ الهجــــــري' ELSE '' END ) APPT_LABEL_ARB, (CASE WHEN a.T_APPT_DATE IS NOT NULL THEN 'Please follow the Gregorian Date, if there is difference in Hijrah actual and calendar date.' ELSE '' END ) APPT_LABEL_ENG, (CASE WHEN a.T_APPT_DATE IS NOT NULL THEN 'Appointment Date : ' || TO_CHAR(a.T_APPT_DATE,'DD/MM/YYYY') ||' - ' || HIJRA_DATE(a.T_APPT_DATE) ||' ***Please follow Gregorian Date for Appointment' ELSE '' END ) APPT_DATE, b.t_ANALYSIS_CODE, ( CASE WHEN T_EXTERNAL_FLAG IS NULL AND T_LOCATION_CODE ='4001' THEN (SELECT T_X_AIDS_PATNO FROM t03001 WHERE T_X_AIDS_PATNO IS NOT NULL AND t_PAT_NO =a.T_PAT_NO ) ELSE'' END ) PNAME , b.t_specimen_code , (select t_lang2_name from t13048 where t_site_code = b.t_specimen_code) specimen_name, b.t_ws_code LAB_WORKSTATION_CODE, (SELECT t_lang2_name FROM t13004 WHERE t_ws_code = b.t_ws_code ) ws_dscrptn , decode(b.t_ws_code, '01', b.t_ws_code||b.T_ANALYSIS_CODE) ws_an, B.t_comment_line lab_ANAL_COMMENT, decode(b.t_single_flag,'1',b.t_single_flag||b.t_ANALYSIS_CODE,'') lab_single_flag from t13015 a, t13016 b where b.t_ws_code in ('05') and a.t_request_no = b.t_request_no and a.t_request_no = '0011334813'");
        }
    }
}

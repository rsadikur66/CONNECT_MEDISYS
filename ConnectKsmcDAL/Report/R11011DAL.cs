using System.Data;

namespace ConnectKsmcDAL.Report
{
    public class R11011DAL : CommonDAL
    {
        public DataTable GetHeaderData(string siteCode)
        {
            return ReportQuery($@"SELECT T_SITE_CODE , T_COUNTRY_LANG1_NAME , T_COUNTRY_LANG2_NAME , T_MIN_LANG1_NAME , T_MIN_LANG2_NAME , T_SITE_LANG1_NAME , T_SITE_LANG2_NAME , T_LOGO_ID , T_LOGO_NAME , T_LOGO , T_LCENCE_NO FROM t01028 WHERE T_SITE_CODE IN(SELECT T_SITE_CODE FROM t01001)");
        }
        public DataTable GetReportData(string orderNo)
        {
            var chk = QueryString($@"SELECT  T11011.T_TMP_FLAG  FROM T11011,T11012 WHERE T11011.T_ORDER_NO = T11012.T_ORDER_NO AND T11011.T_ORDER_NO ='{orderNo}'");
            if (chk == null)
            {
                return ReportQuery($@" SELECT T11011.T_ORDER_NO , '!' || T11011.T_PAT_NO || '!' ORDER_BARCODE , T11011.T_TMP_FLAG , T11011.T_ORDER_DATE , DECODE(T_PRIORITY_CODE,'1','PROTABLE ROUTINE','2','ROUTINE','3','EMERGENCY','4','VERY URGENT','4','PROTABLE EMERGENCY') T_PRIORITY_CODE , T11011.T_PAT_NO , T11011.T_REF_DOC , T11011.T_CLINIC_CODE , T11011.T_FRM_LOCATION , ( CASE WHEN T11011.T_FRM_LOCATION IS NOT NULL THEN ( SELECT T_LANG2_NAME FROM T02042 WHERE T_LOC_CODE = T11011.T_FRM_LOCATION ) WHEN T11011.T_CLINIC_CODE IS NOT NULL THEN ( SELECT T_CLINIC_NAME_LANG2 FROM T07001 WHERE T_CLINIC_CODE = T11011.T_CLINIC_CODE ) ELSE'' END ) FRM_LOC_CLINC_NAME, T11011.T_CLINICAL_DATA , T11011.T_REQUEST_DOC , DECODE(T11011.T_IPOP_FLAG,'1','INPATIENT','2','OPD','3','ER',NULL) T_IPOP_FLAG , T11011.T_CLINIC_SPCLTY_CODE , DECODE(T11011.T_X_HOSP,'1','CENTRAL','2','PEDIA','3','MATERNITY' , NULL) T_X_HOSP , DECODE(T_ALERGY_FLAG,'1','YES','2','NO',NULL) T_ALERGY_FLAG , TO_CHAR( T_LMP_DATE,'dd/MM/yyyy' ) T_LMP_DATE , DECODE(T_PREGNANCY_FLAG,'1','YES','2','NO',NULL) T_PREGNANCY , T11011.T_ORDER_TIME , T11012.T_TYPE_CODE , (SELECT T_LANG2_NAME FROM T11100 WHERE T_MAIN_PROC_CODE = T11012.T_TYPE_CODE)T_TYPE_NAME, T11012.T_PROC_CODE , (SELECT T_PROC_DSCRPTN_LANG2 FROM T11001 WHERE T_PROC_CODE = T11012.T_PROC_CODE) T_PROC_DSCRPTN, T11012.T_PROC_NOTES , T11012.T_INDICATION, T_PAT.T_FIRST_LANG2_NAME||' '||T_PAT.T_FATHER_LANG2_NAME||' '|| T_PAT.T_GFATHER_LANG2_NAME||' '||T_PAT.T_FAMILY_LANG2_NAME T_PAT_NAME , T_PAT.T_BIRTH_DATE , (SELECT TRUNC(MONTHS_BETWEEN(SYSDATE,T_PAT.T_BIRTH_DATE)/12) FROM DUAL ) AGE_Y, (SELECT TRUNC(MOD(MONTHS_BETWEEN(SYSDATE, T_PAT.T_BIRTH_DATE), 12)) FROM DUAL ) AGE_M, (SELECT TRUNC(SYSDATE) - ADD_MONTHS(T_PAT.T_BIRTH_DATE, TRUNC(MONTHS_BETWEEN(SYSDATE,T_PAT.T_BIRTH_DATE))) AS DAYS FROM DUAL)AGE_D, T_PAT.T_GENDER , NVL(T_PAT.T_X_RMC_CHRTNO,T_PAT.T_X_HOSP1_PAT_NO)T_X_HOSP1_PAT_NO , T_PAT.T_NTNLTY_CODE , T_GEN.T_LANG2_NAME T_GENDER_NAME,   T_NAT.T_LANG2_NAME T_NATIONALITY_NAME, T_PAT.T_PAYOR_Y , (CASE WHEN T_PAT.T_PAYOR_Y='1' THEN 'PAID TREATMENT' WHEN T_PAT.T_PAYOR_Y='2' THEN 'ELIGIBLE' WHEN T_PAT.T_PAYOR_Y='3' THEN 'ROYAL ORDER' ELSE '' END )T_PAYOR_Y_STATUS, (SELECT MAX(T_MOBILE_NO) FROM T01009,T35001 WHERE T_EMP_CODE = T_USER_CODE AND T_DOC_CODE = T11011.T_REQUEST_DOC) T_DOC_MOBILE_NO, (SELECT T_NAME_GIVEN || ' '|| T_NAME_FATHER || ' '||T_NAME_GFATHER DOC_NAME FROM T02029 WHERE T_EMP_NO = T11011.T_REQUEST_DOC ) T_DOC_NAME FROM T11011 JOIN T11012 ON T11011.T_ORDER_NO = T11012.T_ORDER_NO JOIN T03001 T_PAT ON T11011.T_PAT_NO = T_PAT.T_PAT_NO JOIN T02006 T_GEN ON T_GEN.T_SEX_CODE = T_PAT.T_GENDER JOIN T02003 T_NAT ON T_PAT.T_NTNLTY_CODE = T_NAT.T_NTNLTY_CODE WHERE T11011.T_ORDER_NO = '{orderNo}'");
            }
            else
            {
                return ReportQuery($@"SELECT T11011.T_ORDER_NO , '!' || T11011.T_PAT_NO || '!' ORDER_BARCODE , T11011.T_TMP_FLAG , T11011.T_ORDER_DATE , DECODE(T_PRIORITY_CODE,'1','PROTABLE ROUTINE','2','ROUTINE','3','EMERGENCY','4','VERY URGENT','4','PROTABLE EMERGENCY') T_PRIORITY_CODE , T11011.T_PAT_NO , T11011.T_REF_DOC , T11011.T_CLINIC_CODE , T11011.T_FRM_LOCATION , ( CASE WHEN T11011.T_FRM_LOCATION IS NOT NULL THEN ( SELECT T_LANG2_NAME FROM T02042 WHERE T_LOC_CODE = T11011.T_FRM_LOCATION ) WHEN T11011.T_CLINIC_CODE IS NOT NULL THEN (SELECT T_CLINIC_NAME_LANG2 FROM T07001 WHERE T_CLINIC_CODE = T11011.T_CLINIC_CODE ) ELSE'' END ) FRM_LOC_CLINC_NAME, T11011.T_CLINICAL_DATA , T11011.T_REQUEST_DOC , DECODE(T11011.T_IPOP_FLAG,'1','INPATIENT','2','OPD','3','ER',NULL) T_IPOP_FLAG , T11011.T_CLINIC_SPCLTY_CODE , DECODE(T11011.T_X_HOSP,'1','CENTRAL','2','PEDIA','3','MATERNITY' , NULL) T_X_HOSP , DECODE(T_ALERGY_FLAG,'1','YES','2','NO',NULL) T_ALERGY_FLAG , TO_CHAR( T_LMP_DATE,'dd/MM/yyyy' ) T_LMP_DATE , DECODE(T_PREGNANCY_FLAG,'1','YES','2','NO',NULL) T_PREGNANCY , T11011.T_ORDER_TIME , T11012.T_TYPE_CODE , (SELECT T_LANG2_NAME FROM T11100 WHERE T_MAIN_PROC_CODE = T11012.T_TYPE_CODE )T_TYPE_NAME, T11012.T_PROC_CODE , (SELECT T_PROC_DSCRPTN_LANG2 FROM T11001 WHERE T_PROC_CODE = T11012.T_PROC_CODE ) T_PROC_DSCRPTN, T11012.T_PROC_NOTES , T11012.T_INDICATION, T_PAT.T_FIRST_LANG2_NAME ||' ' ||T_PAT.T_FATHER_LANG2_NAME ||' ' || T_PAT.T_GFATHER_LANG2_NAME ||' ' ||T_PAT.T_FAMILY_LANG2_NAME T_PAT_NAME , T_PAT.T_BIRTH_DATE , (SELECT TRUNC(MONTHS_BETWEEN(SYSDATE,T_PAT.T_BIRTH_DATE)/12) FROM DUAL ) AGE_Y, (SELECT TRUNC(MOD(MONTHS_BETWEEN(SYSDATE, T_PAT.T_BIRTH_DATE), 12)) FROM DUAL ) AGE_M, (SELECT TRUNC(SYSDATE) - ADD_MONTHS(T_PAT.T_BIRTH_DATE, TRUNC(MONTHS_BETWEEN(SYSDATE,T_PAT.T_BIRTH_DATE))) AS DAYS FROM DUAL )AGE_D, T_PAT.T_GENDER ,  T_GEN.T_LANG2_NAME T_GENDER_NAME,   T_NAT.T_LANG2_NAME T_NATIONALITY_NAME,T_PAT.T_NTNLTY_CODE , T_PAT.T_PAYOR_Y , ( CASE WHEN T_PAT.T_PAYOR_Y='1' THEN 'PAID TREATMENT' WHEN T_PAT.T_PAYOR_Y='2' THEN 'ELIGIBLE' WHEN T_PAT.T_PAYOR_Y='3' THEN 'ROYAL ORDER' ELSE '' END )T_PAYOR_Y_STATUS, (SELECT MAX(T_MOBILE_NO) FROM T01009, T35001 WHERE T_EMP_CODE = T_USER_CODE AND T_DOC_CODE = T11011.T_REQUEST_DOC ) T_DOC_MOBILE_NO, (SELECT T_NAME_GIVEN || ' ' || T_NAME_FATHER || ' ' ||T_NAME_GFATHER DOC_NAME FROM T02029 WHERE T_EMP_NO = T11011.T_REQUEST_DOC ) T_DOC_NAME FROM T11011 JOIN T11012 ON T11011.T_ORDER_NO = T11012.T_ORDER_NO JOIN T03003 T_PAT ON T11011.T_PAT_NO = T_PAT.T_TMP_PAT_NO JOIN T02006 T_GEN ON T_GEN.T_SEX_CODE = T_PAT.T_GENDER JOIN T02003 T_NAT ON T_PAT.T_NTNLTY_CODE = T_NAT.T_NTNLTY_CODE WHERE T11011.T_ORDER_NO = '{orderNo}'");
            }
        }
        public DataTable GetQuestionaries(string orderNo)
        {
            return ReportQuery($@"SELECT Decode(T_M_FEED,null,'0','1') Breast_feeding, Decode(T_M_CON ,null,'0','1') Contraceptive, T_M_CHL Howlong, Decode(T_M_HRT ,null,'0','1') HRT, DECODE(T_M_HCAN ,null,'0','1') HCHAN, DECODE(T_M_HRAD,null,'0','1') hrad, decode(T_M_MSLR,null,'0','1') mslr, decode(T_M_MSLL,null,'0','1') msll, decode(T_M_AXIR,null,'0','1') axir, decode(T_M_AXIL,null,'0','1') axil, decode(T_M_NIPPR,null,'0','1') nippr, decode(T_M_NIPPL,null,'0','1') nippl, decode(T_M_SKNR,null,'0') skinr, decode(T_M_SKNL,null,'0','1') skinl, decode(T_M_NIPDSR,null,'0','1') nipdsr, decode(T_M_NIPDSL,null,'0','1') nipdsl, decode(T_M_PAINR,null,'0','1') PAINR, decode(T_M_PAINL,null,'0','1') PAINL, DECODE(T_M_HCHEM,null,'0','1') HCHEM, T_M_TUMSPY, T_M_FMHIS, T_M_AGEDIA, T_M_HHL HHowlong, Decode(T_M_MAM ,null,'0','1') Mammogram , TO_CHAR(T_M_DATE ,'dd/MM/yyyy'  ) Mam_Date , Decode(T_M_PMAM,'1','To exclude the Malignancy','2','Routine screening','3','Follow-up existing lesion',null) Purpose , Decode(T_M_LES ,null,'0','1') lesion, T_M_LWH les_Where, Decode(T_M_AXI ,null,'0','1') Axillary, Decode(T_M_DWM ,'1','Days','2','Weeks','3','Months') Complaint , Decode(T_M_NIP,'1','Yes','2','No','3','Right','4','Left','5','Multiporal','6','Uniporal') Nipple, Decode(T_M_TUM ,null,'0','1') Trauma, Decode(T_M_BRE,'1','Yes','2','No','3','Right','4','Left') Breast_surgery, T_M_BCAU Cause, Decode(T_M_HCAN ,null,'0','1') History_cancer, Decode(T_M_FAMB,null,'0','1') Family_cancer, T_M_FMHIS, T_M_OTHERS, Decode(T_M_FMSD,'1','Mother','2','Sister','3','Daughter','4','Others') Family_yes, Decode(T_M_CLI ,'1','Benign','2','Malignant') Clinical FROM T11019 WHERE T_ORDER_NO = '{orderNo}'");
        }
    }
}

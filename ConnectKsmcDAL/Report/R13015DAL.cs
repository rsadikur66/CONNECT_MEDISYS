
using System;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
namespace ConnectKsmcDAL.Report
{
    public class R13015DAL :CommonDAL    
    {
               public DataTable GetHeaderData(string siteCode)
        {
            return ReportQuery($@"SELECT T_SITE_CODE , T_COUNTRY_LANG1_NAME , T_COUNTRY_LANG2_NAME , T_MIN_LANG1_NAME , T_MIN_LANG2_NAME , T_SITE_LANG1_NAME , T_SITE_LANG2_NAME , T_LOGO_ID , T_LOGO_NAME , T_LOGO , T_LCENCE_NO FROM t01028 WHERE T_SITE_CODE IN(SELECT T_SITE_CODE FROM t01001)");
        }
        public DataTable GetMasterData(string reqNo)
        {
            return ReportQuery($@"SELECT '!'||T_1.T_REQUEST_NO ||'!' T_barcode, T_1.T_PAT_NO, ( CASE WHEN T_EXTERNAL_FLAG is null THEN ( select T_FIRST_LANG2_NAME||' '||T_FATHER_LANG2_NAME||' '|| T_GFATHER_LANG2_NAME||' '||T_FAMILY_LANG2_NAME from t03001 where t_pat_no = T_1.T_PAT_NO ) ELSE( select T_FIRST_LANG2_NAME||' '||T_FATHER_LANG2_NAME||' '|| T_GFATHER_LANG2_NAME||' '||T_FAMILY_LANG2_NAME from t03003 where t_tmp_pat_no = T_1.T_PAT_NO )END ) pat_name_eng, ( CASE WHEN T_EXTERNAL_FLAG is null THEN ( select T_FIRST_LANG1_NAME||' '||T_FATHER_LANG1_NAME||' '|| T_GFATHER_LANG1_NAME||' '||T_FAMILY_LANG1_NAME from t03001 where t_pat_no = T_1.T_PAT_NO ) ELSE( select T_FIRST_LANG1_NAME||' '||T_FATHER_LANG1_NAME||' '|| T_GFATHER_LANG1_NAME||' '||T_FAMILY_LANG1_NAME from t03003 where t_tmp_pat_no = T_1.T_PAT_NO )END ) pat_name_arb, T_1.T_EXTERNAL_FLAG, (CASE WHEN T_1.T_EXTERNAL_FLAG IS NOT NULL THEN 'YES' ELSE '' END )T_EXTERNAL_STATUS, (CASE WHEN T_1.T_EXTERNAL_FLAG is null THEN (SELECT trunc ( (sysdate-T_BIRTH_DATE)/365,0) || ' ' || 'Y' || ' ' ||TRUNC(MOD(MONTHS_BETWEEN(sysdate,T_BIRTH_DATE), 12), 0)|| ' ' ||'M' || ' '|| trunc ((sysdate) - add_months( T_BIRTH_DATE,trunc(months_between(trunc(sysdate),T_BIRTH_DATE)))) ||' '||'D' FROM t03001 WHERE t03001.T_PAT_NO = T_1.T_PAT_NO) ELSE ( SELECT trunc ( (sysdate-T_BIRTH_DATE)/365,0) || ' ' || 'Y' ||' ' || TRUNC(MOD(MONTHS_BETWEEN(sysdate,T_BIRTH_DATE), 12), 0)|| ' ' ||'M' || ' '||trunc ((sysdate) - add_months( T_BIRTH_DATE,trunc(months_between(trunc(sysdate),T_BIRTH_DATE)))) ||' '||'D' FROM t03003 WHERE t_TMP_PAT_NO = T_1.T_PAT_NO) END ) T_AGE , (CASE WHEN T_1.T_EXTERNAL_FLAG is null THEN (SELECT T02006.T_LANG2_NAME FROM t03001 t_pat JOIN t02006 ON t_pat.t_gender = T02006.T_SEX_CODE WHERE T_PAT_NO = T_1.T_PAT_NO) ELSE ( SELECT T02006.T_LANG2_NAME FROM t03003 t_pat JOIN t02006 ON t_pat.t_gender = T02006.T_SEX_CODE WHERE T_TMP_PAT_NO = T_1.T_PAT_NO ) END ) T_GENDER , T_1.T_LOCATION_CODE, ( CASE WHEN T_PAT_TYPE ='2' THEN (CASE WHEN t_location_code ='2000' THEN 'OPD Central' ELSE (CASE WHEN (select T_CLINIC_NAME_LANG2 from T07001 where T_CLINIC_CODE = T_1.T_LOCATION_CODE) IS NOT NULL THEN (select T_CLINIC_NAME_LANG2 from T07001 where T_CLINIC_CODE = T_1.T_LOCATION_CODE) ELSE (select T_LANG2_NAME from T02042 where t_loc_code = T_1.T_LOCATION_CODE) END ) END ) WHEN T_PAT_TYPE ='3' THEN ( select t_lang2_name from t04003 where t_er_location = T_1.T_LOCATION_CODE) WHEN (select T_LANG2_NAME from T02042 where t_loc_code = T_1.T_LOCATION_CODE) IS NOT NULL THEN (select T_LANG2_NAME from T02042 where t_loc_code = T_1.T_LOCATION_CODE) ELSE(select T_CLINIC_NAME_LANG2 from T07001 where T_CLINIC_CODE = T_1.T_LOCATION_CODE) END )location_dscrptn, T_1.T_PAT_TYPE , (select t_lang2_name from t05020 where t_episode_type = T_1.T_PAT_TYPE ) type_dscrptn, (CASE WHEN T_EXTERNAL_FLAG IS NULL THEN (SELECT DECODE(T_PAYOR_Y,'1','Yes','No') FROM t03001 WHERE T_PAT_NO= T_1.T_PAT_NO) ELSE'' END ) PAYOR, T_1.T_PRIORITY_CODE, ( select t_lang2_name from t13003 where t_priority_code = T_1.T_PRIORITY_CODE ) priority_dscrptn, (SELECT T_ROOM_NO ||'--' || T_BED_NO FROM T05005 WHERE T_PAT_NO = T_1.T_PAT_NO) ROOM, (CASE WHEN T_1.T_PRIORITY_CODE IN ('1','2') THEN (select t_lang2_name from t13003 where t_priority_code = T_1.T_PRIORITY_CODE) || ' REQUEST' ELSE '' END ) STAT_REPORT, T_1.T_REQUEST_DATE , T_1.T_REQUEST_NO , T_1.T_SPEC_NO spec_no , '!'||T_1.T_REQUEST_NO||'!' BC, T_1.T_REQUEST_TIME , T_1.T_DOC_CODE, (SELECT T_NAME_GIVEN ||' '|| T_NAME_FATHER ||' '||T_NAME_FAMILY FROM T02029 WHERE T_EMP_NO = T_1.T_DOC_CODE ) doctor_name, T_1.T_COMMENT_LINE, T_1.t_clinic_data, T_1.T_APPT_DATE APPT_DATE, (CASE WHEN T_1.T_APPT_DATE is NOT null THEN 'Appointment Date : ' || TO_CHAR(T_1.T_APPT_DATE,'DD/MM/YYYY') ||' - ' || HIJRA_DATE(T_1.T_APPT_DATE) ||' ***Please follow Gregorian Date for Appointment' ELSE'' END) APPT_DATE_DES, (CASE WHEN T_1.T_APPT_DATE is NOT null THEN '.?????????????? ?????????????? ???????? ??????????? ???????? ??????????? ???????????? ????????????' ELSE'' END) APPT_ARB_LABEL, (CASE WHEN T_1.T_APPT_DATE is NOT null THEN 'Please follow the Gregorian Date, if there is difference in Hijrah actual and calendar date.' ELSE'' END) APPT_ENG_LABEL, T_1.t_ANALYSIS_CODE, (CASE WHEN T_1.t_ANALYSIS_CODE ='01048' THEN 'Collect the semen after 2 days but not longer than 7 days of sexual abstinence Collect the complete semen into the container provided and keep warm Deliver the sample to the laboratory within 1 hour of collection. Receving Sample will be on Sunday and Tuesday between 08:00 AM to 11:00 AM ' || chr(10) || chr(10) ||'جمع السائل المنوي بعد 2 يوم لكن ليس لفترة اطول من 7 ايام من الامتناع عن ممارسة الجنس جمع السائل المنوي فى وعاء تقديم دافئ تسلم العينة فى غضون ساعة من جمعها سوف يكون تسليم العينة فى يوم الاثنين والاربعاء بين الساعة 8 صباحا حتى 11 صباحا' WHEN T_1.t_tb_diag IS NOT NULL THEN decode(T_1.t_tb_diag,'1','Diagnosis ','2','Followup ',null || chr(10) || chr(10) || '???????? ?? ?????? ???? ????? ?? ????? ??? ???? ?? ???? ???? ??? ??? ?????? ??? ?????? ????? ?? ?????? ??????? ?? ??? ??????? ??? ????? ?? ?? ???? ??? ?? ???? ?????? ??? ??????? ??????? ?????? ?? ??? ?????? ???? ????? ??? ??? ?????? ') WHEN T_1.t_ws_code ='15' AND T_1.t_ANALYSIS_CODE IN ('15001','15002') THEN 'HLA/PRA is done on prior appointment from Immunology Department only Ext 1461' || chr(10) || chr(10) || '???????? ?? ?????? ???? ????? ?? ????? ??? ???? ?? ???? ???? ??? ??? ?????? ??? ?????? ????? ?? ?????? ??????? ?? ??? ??????? ??? ????? ?? ?? ???? ??? ?? ???? ?????? ??? ??????? ??????? ?????? ?? ??? ?????? ???? ????? ??? ??? ?????? ' ELSE '' END ) SEMEN_COMMENT, T_1.T_ENTRY_USER, T_1.ENTRY_USER , (SELECT T_ROLE_CODE FROM T01009 WHERE T_EMP_CODE=T_1.T_ENTRY_USER )T_ROLE_CODE, ( select 'Requested By : ' || t_user_name from t01009 where t_emp_code = T_1.T_ENTRY_USER) user_name, ( SELECT T_X_AIDS_PATNO FROM t03001 WHERE T_X_AIDS_PATNO IS NOT NULL AND t_PAT_NO =T_1.T_PAT_NO )T_X_AIDS_PATNO , (CASE WHEN T_EXTERNAL_FLAG IS NULL AND T_LOCATION_CODE ='4001' THEN (SELECT T_X_AIDS_PATNO FROM t03001 WHERE T_X_AIDS_PATNO IS NOT NULL AND t_PAT_NO =T_1.T_PAT_NO ) ELSE'' END ) PNAME , T_1.t_ws_code LAB_WORKSTATION_CODE, (SELECT t_lang2_name FROM t13004 WHERE t_ws_code = T_1.t_ws_code) ws_dscrptn , (SELECT t_lang2_name from t13011 where t_analysis_code =T_1.t_ANALYSIS_CODE AND t_ws_code= T_1.t_ws_code) ANALYSIS_DSCRPTN, (SELECT NVL(T_X_RMC_CHRTNO,T_X_HOSP1_PAT_NO) FROM T03001 WHERE T_PAT_NO =T_1.T_PAT_NO) HOSP_NO, (SELECT T_X_HOSP7_PAT_NO FROM T03001 WHERE T_PAT_NO = T_1.T_PAT_NO) RCH_NO, (CASE WHEN (SELECT T_X_HOSP7_PAT_NO FROM T03001 WHERE T_PAT_NO = T_1.T_PAT_NO) IS NOT NULL THEN ' AKU# ' ELSE '' END )TXT, decode(T_1.t_ws_code, '01', T_1.t_ws_code||T_1.T_ANALYSIS_CODE) ws_an, T_1.t_comment_line_B lab_ANAL_COMMENT, decode(T_1.t_single_flag,'1',T_1.t_single_flag||T_1.t_ANALYSIS_CODE,'') lab_single_flag , decode(T_1.t_tb_diag,'1','Diagnosis ','2','Followup ',null) TB_DIAG FROM ( select a.T_PAT_NO, a.T_EXTERNAL_FLAG, a.T_LOCATION_CODE, a.T_PAT_TYPE , a.T_PRIORITY_CODE, a.T_REQUEST_DATE , a.T_REQUEST_NO , a.T_SPEC_NO , a.T_REQUEST_TIME , a.T_DOC_CODE, a.T_COMMENT_LINE, a.t_clinic_data, a.T_APPT_DATE , b.t_ANALYSIS_CODE, B.T_ENTRY_USER, A.T_ENTRY_USER ENTRY_USER, b.t_ws_code , B.t_comment_line t_comment_line_B, b.t_single_flag , b.t_tb_diag from t13015 a, t13016 b where a.t_request_no = '{reqNo}' and b.t_ws_code not in ('05') and a.t_request_no = b.t_request_no and b.t_analysis_code not between '2150' and '2165' union all select a.T_PAT_NO, a.T_EXTERNAL_FLAG, a.T_LOCATION_CODE, a.T_PAT_TYPE , a.T_PRIORITY_CODE, a.T_REQUEST_DATE , a.T_REQUEST_NO , a.T_SPEC_NO , a.T_REQUEST_TIME , a.T_DOC_CODE, a.T_COMMENT_LINE, a.t_clinic_data, a.T_APPT_DATE , b.t_ANALYSIS_CODE, B.T_ENTRY_USER, A.T_ENTRY_USER ENTRY_USER , b.t_ws_code , B.t_comment_line t_comment_line_B , b.t_single_flag , b.t_tb_diag from t13015 a, t13016 b where a.t_request_no = '{reqNo}' and b.t_ws_code not in ('05') and a.t_request_no = b.t_request_no and b.t_analysis_code between '2150' and '2165' )T_1 ");
        }
    }
}
